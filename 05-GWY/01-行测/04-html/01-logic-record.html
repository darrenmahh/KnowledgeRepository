<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>判断推理错题自动计数器 (带数据保存)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Arial', 'sans-serif';
        }
        .counter-btn {
            transition: all 0.2s ease-in-out;
        }
        .counter-btn:hover {
            transform: scale(1.1);
        }
        .reset-btn:hover {
            opacity: 0.8;
        }
        #confirmation-modal {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">判断推理错题归纳统计</h1>
            <p class="mt-2 text-gray-600">点击按钮记录错题，数据将自动保存在您的浏览器中。</p>
        </header>

        <!-- Global Controls -->
        <div class="flex justify-center mb-8 space-x-4">
            <button id="export-data" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-300">
                导出统计
            </button>
            <button id="reset-all" class="bg-red-500 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-red-600 transition-colors duration-300">
                全部重置
            </button>
        </div>

        <!-- Main Content -->
        <div class="space-y-8">
            
            <!-- Section 1: 论证 -->
            <section id="part1" class="bg-white p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4 border-b pb-3">
                    <h2 class="text-2xl font-bold text-blue-600">第一部分：论证</h2>
                    <div class="text-lg font-semibold text-gray-700">总计: 
                        <span id="total-part1" class="bg-blue-100 text-blue-800 py-1 px-3 rounded-full">0</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">章节</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">核心知识点</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">计数操作</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <!-- Rows for Part 1 -->
                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="4">二、归因论证</td><td>对比实验 (他因/因果倒置/否定此因)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>时间对比/反常情况</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>直接/根本原因模型</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>构成或补充对比实验</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            
                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="3">三、数量论证</td><td>比例类 (混淆比例与绝对数)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>抽样类 (样本不具代表性)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>其他数学模型 (盐水/容斥/乘积等)</td><td class="text-center"><div class="counter-controls"></div></td></tr>

                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="2">四、严谨逻辑</td><td>质疑 A→B (寻找 A 且非 B)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>支持/前提 A→B (搭桥)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            
                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="3">五、一般质疑</td><td>断点拆桥 (论据与结论无关)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>增加反向论据 (以偏概全/考虑不周)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>质疑论据/结论 (真实性/无中生有)</td><td class="text-center"><div class="counter-controls"></div></td></tr>

                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="3">六、支持/前提/解释</td><td>支持 (解释/搭桥/正向论据/举例)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>前提 (必要条件/反向代入)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>解释 (为矛盾现象找合理理由)</td><td class="text-center"><div class="counter-controls"></div></td></tr>

                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="2">九、结构方式</td><td>推理方式判断 (演绎/归纳/类比)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>论证结构/错误相似</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 2: 翻译与分析 -->
            <section id="part2" class="bg-white p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4 border-b pb-3">
                    <h2 class="text-2xl font-bold text-green-600">第二部分：翻译与分析</h2>
                    <div class="text-lg font-semibold text-gray-700">总计: 
                        <span id="total-part2" class="bg-green-100 text-green-800 py-1 px-3 rounded-full">0</span>
                    </div>
                </div>
                 <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">章节</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">核心知识点</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">计数操作</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <!-- Rows for Part 2 -->
                             <tr><td class="px-6 py-4 font-semibold align-top" rowspan="6">一、逻辑基础</td><td>命题关系 (原/逆/否/逆否)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>复合命题 (且/或/要么)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>假言命题翻译 (如果/只有/除非)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>假言命题真假 (p真q假才为假)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>模态与直言命题 (必然/可能/所有/有些)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>充分必要条件</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            
                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="4">七、翻译推理</td><td>等价推出 (翻译找等价)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>正推/逆推 (根据事实或结果推导)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>两难推理</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>范畴推理 (集合关系)</td><td class="text-center"><div class="counter-controls"></div></td></tr>

                            <tr><td class="px-6 py-4 font-semibold align-top" rowspan="3">八、分析推理</td><td>真假话分析 (矛盾法/假设法)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>日常分析 (画表/画图/赋值法)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                            <tr><td>特殊模型 (分类/包含/多重身份/冠军等)</td><td class="text-center"><div class="counter-controls"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden">
        <div class="p-8 border w-96 shadow-lg rounded-xl bg-white m-4">
            <div class="text-center">
                <h3 class="text-2xl font-bold text-gray-900">确认操作</h3>
                <p class="text-sm text-gray-500 mt-2 px-4">您确定要重置所有计数吗？此操作会清除所有已保存的数据，且无法撤销。</p>
                <div class="flex justify-center mt-6 space-x-4">
                    <button id="cancel-reset" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                        取消
                    </button>
                    <button id="confirm-reset" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                        确认重置
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden">
        <div class="p-8 border w-full max-w-4xl shadow-lg rounded-xl bg-white m-4 max-h-[90vh] overflow-y-auto">
            <div class="text-center">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">导出错题统计</h3>
                <div class="flex justify-center mb-4 space-x-4">
                    <button id="generate-export" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        生成统计
                    </button>
                    <button id="cancel-export" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                        取消
                    </button>
                </div>
                <div id="export-result" class="hidden">
                    <div class="bg-gray-50 p-4 rounded-lg text-left">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-gray-700">生成的Markdown格式统计：</h4>
                            <button id="copy-export" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm">
                                复制到剪贴板
                            </button>
                        </div>
                        <textarea id="export-content" class="w-full h-64 p-3 border border-gray-300 rounded-lg font-mono text-sm" readonly></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 定义用于本地存储的键名
            const storageKey = 'wrongQuestionCounts';

            // 为每个计数器创建控制按钮
            function createCounterControls(id) {
                const controlWrapper = document.createElement('div');
                controlWrapper.className = 'flex items-center justify-center space-x-2 sm:space-x-3';

                const minusBtn = document.createElement('button');
                minusBtn.textContent = '-';
                minusBtn.className = 'minus-btn counter-btn bg-yellow-400 text-yellow-800 font-bold w-7 h-7 sm:w-8 sm:h-8 rounded-full shadow-sm hover:bg-yellow-500';
                controlWrapper.appendChild(minusBtn);

                const countSpan = document.createElement('span');
                countSpan.textContent = '0';
                countSpan.className = 'count-display font-bold text-lg w-10 text-center';
                // 为每个计数器设置一个唯一的数据ID，用于存储和读取
                countSpan.setAttribute('data-id', `counter-${id}`);
                controlWrapper.appendChild(countSpan);

                const plusBtn = document.createElement('button');
                plusBtn.textContent = '+';
                plusBtn.className = 'plus-btn counter-btn bg-green-400 text-green-800 font-bold w-7 h-7 sm:w-8 sm:h-8 rounded-full shadow-sm hover:bg-green-500';
                controlWrapper.appendChild(plusBtn);
                
                return controlWrapper;
            }

            // 将控制按钮添加到页面上所有占位符中
            const controlPlaceholders = document.querySelectorAll('.counter-controls');
            controlPlaceholders.forEach((placeholder, index) => {
                placeholder.appendChild(createCounterControls(index));
            });
            
            // --- 新功能：将所有计数保存到 localStorage ---
            function saveData() {
                const counts = {};
                document.querySelectorAll('.count-display').forEach(span => {
                    const id = span.getAttribute('data-id');
                    const count = span.textContent;
                    counts[id] = count;
                });
                localStorage.setItem(storageKey, JSON.stringify(counts));
            }

            // --- 新功能：从 localStorage 加载数据 ---
            function loadData() {
                const savedCounts = localStorage.getItem(storageKey);
                if (savedCounts) {
                    const counts = JSON.parse(savedCounts);
                    Object.keys(counts).forEach(id => {
                        const span = document.querySelector(`.count-display[data-id="${id}"]`);
                        if (span) {
                            span.textContent = counts[id];
                        }
                    });
                }
            }

            // 更新总计的函数
            function updateTotals() {
                let total1 = 0;
                document.querySelectorAll('#part1 .count-display').forEach(c => total1 += parseInt(c.textContent, 10));
                document.getElementById('total-part1').textContent = total1;

                let total2 = 0;
                document.querySelectorAll('#part2 .count-display').forEach(c => total2 += parseInt(c.textContent, 10));
                document.getElementById('total-part2').textContent = total2;
            }

            // 为所有按钮添加事件监听器
            document.querySelectorAll('.counter-controls').forEach(controlSet => {
                const countSpan = controlSet.querySelector('.count-display');
                
                controlSet.querySelector('.plus-btn').addEventListener('click', () => {
                    countSpan.textContent = parseInt(countSpan.textContent, 10) + 1;
                    updateTotals();
                    saveData(); // 每次变动后保存数据
                });

                controlSet.querySelector('.minus-btn').addEventListener('click', () => {
                    let currentCount = parseInt(countSpan.textContent, 10);
                    if (currentCount > 0) {
                        countSpan.textContent = currentCount - 1;
                        updateTotals();
                        saveData(); // 每次变动后保存数据
                    }
                });
            });
            
            // --- 新功能：处理重置确认模态框 ---
            const modal = document.getElementById('confirmation-modal');
            const cancelBtn = document.getElementById('cancel-reset');
            const confirmBtn = document.getElementById('confirm-reset');
            const resetAllBtn = document.getElementById('reset-all');

            resetAllBtn.addEventListener('click', () => {
                modal.classList.remove('hidden'); // 显示模态框
            });

            cancelBtn.addEventListener('click', () => {
                modal.classList.add('hidden'); // 隐藏模态框
            });

            confirmBtn.addEventListener('click', () => {
                document.querySelectorAll('.count-display').forEach(counter => {
                    counter.textContent = '0';
                });
                localStorage.removeItem(storageKey); // 从本地存储中移除数据
                updateTotals();
                modal.classList.add('hidden'); // 隐藏模态框
            });

            // --- 新功能：处理导出功能 ---
            const exportModal = document.getElementById('export-modal');
            const exportBtn = document.getElementById('export-data');
            const cancelExportBtn = document.getElementById('cancel-export');
            const generateExportBtn = document.getElementById('generate-export');
            const copyExportBtn = document.getElementById('copy-export');

            const exportResult = document.getElementById('export-result');
            const exportContent = document.getElementById('export-content');

            exportBtn.addEventListener('click', () => {
                exportModal.classList.remove('hidden');
            });

            cancelExportBtn.addEventListener('click', () => {
                exportModal.classList.add('hidden');
                exportResult.classList.add('hidden');
                exportContent.value = '';
            });

            generateExportBtn.addEventListener('click', () => {
                const content = generateTextStatistics();
                exportContent.value = content;
                exportResult.classList.remove('hidden');
            });

            copyExportBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(exportContent.value);
                    // 临时改变按钮文本以提供反馈
                    const originalText = copyExportBtn.textContent;
                    copyExportBtn.textContent = '已复制！';
                    copyExportBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                    copyExportBtn.classList.add('bg-green-600');
                    setTimeout(() => {
                        copyExportBtn.textContent = originalText;
                        copyExportBtn.classList.remove('bg-green-600');
                        copyExportBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                    }, 1500);
                } catch (err) {
                    alert('复制失败，请手动复制文本');
                }
            });

            // 生成纯文字统计的函数
            function generateTextStatistics() {
                let textContent = '';
                const sections = document.querySelectorAll('section[id^="part"]');

                sections.forEach(section => {
                    const sectionTitle = section.querySelector('h2').textContent.trim();
                    const sectionItems = [];

                    section.querySelectorAll('tbody tr').forEach(row => {
                        const countSpan = row.querySelector('.count-display');
                        // The knowledge point is in the second-to-last cell of the row
                        const knowledgeCell = row.querySelector('td:nth-last-child(2)');

                        if (countSpan && knowledgeCell) {
                            const count = parseInt(countSpan.textContent, 10);
                            if (count > 0) {
                                const knowledgePoint = knowledgeCell.textContent.trim();
                                sectionItems.push({
                                    knowledge: knowledgePoint,
                                    count: count
                                });
                            }
                        }
                    });

                    if (sectionItems.length > 0) {
                        textContent += `- **${sectionTitle}**\n`;
                        sectionItems.forEach(item => {
                            textContent += `    - ${item.knowledge}: ${item.count}\n`;
                        });
                        textContent += '\n'; // Add a blank line between sections
                    }
                });

                if (textContent.trim() === '') {
                    textContent = '暂无错题记录。';
                }

                return textContent.trim();
            }

            // --- 页面加载时执行 ---
            loadData(); // 首先加载已保存的数据
            updateTotals(); // 然后根据加载的数据更新总计
        });
    </script>

</body>
</html>